<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Pixiurge::Middleware::Tilt
  
    &mdash; Pixiurge API Documentation
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Pixiurge::Middleware::Tilt";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (T)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Pixiurge.html" title="Pixiurge (module)">Pixiurge</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Middleware.html" title="Pixiurge::Middleware (module)">Middleware</a></span></span>
     &raquo; 
    <span class="title">Tilt</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Pixiurge::Middleware::Tilt
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Pixiurge::Middleware::Tilt</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/pixiurge/config_ru.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>The Tilt middleware serves Tilt (template) directories. See
<a href="https://github.com/rtomayko/tilt">https://github.com/rtomayko/tilt</a> for the list of supported
template engines.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>

</div>
  <h2>Constant Summary</h2>
  <dl class="constants">
    
      <dt id="MIME_TYPE_EXTENSION_MAP-constant" class="">MIME_TYPE_EXTENSION_MAP =
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>

</div>
      </dt>
      <dd><pre class="code"><span class='lbrace'>{</span>
<span class='rbrace'>}</span></pre></dd>
    
  </dl>







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#call-instance_method" title="#call (instance method)">#<strong>call</strong>(env)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The Rack .call method for middleware.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(app, options = {})  &#x21d2; Tilt </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Constructor.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(app, options = {})  &#x21d2; <tt><span class='object_link'><a href="" title="Pixiurge::Middleware::Tilt (class)">Tilt</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Constructor. If you supply a list of engines, you&#39;ll need to
make sure the appropriate gems are included for them.  For
instance if you supply &quot;haml&quot; as an engine, make sure to include
the &quot;haml&quot; gem for your game.</p>

<p>This can be used to serve Ruby template files like Erb or Haml,
but also Markdown, CoffeeScript, TypeScript, LiveScript, Less,
Sass/Scss and more with the right gems. See
<a href="https://github.com/rtomayko/tilt">https://github.com/rtomayko/tilt</a> for the list of supported
template engines.</p>

<p>For templating libraries like Erb that can handle any file type,
this middleware will <em>strip</em> extensions.  That means something
ending in &quot;.html.erb&quot; will only be served if you ask for the
same with &quot;.html&quot;. You can do the same with something like
CoffeeScript, so you could name your files
whatever_filename.js.coffee if you want them to be converted to
JS and served with a .js extension. But the middleware will also
try to use sane extensions (convert .coffee to .js, etc) where
it can. If you have trouble, try manually using the &quot;stripped&quot;
extension trick (e.g. my_file.js.coffee or my_file.html.haml).</p>

<p>Note that multiple instances don&#39;t keep the extensions separate,
so it may be hard to keep from serving Markdown files out of
your Haml directory... Don&#39;t keep files in your asset
directories if you&#39;re worried about your users seeing them, in
general.</p>

<p>In production it will be faster to &quot;bake&quot; these directories into
static files of the appropriate type instead of converting on
the server.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>app</span>
      
      
        <span class='type'>(<tt>Rack::App</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The next innermost Rack app</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Options to this middleware</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:urls</span>
          <span class="type">(<tt>String</tt>, <tt>Array&lt;String&gt;</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>A root or list of URL roots to serve TMX files from</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:root</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>The file system root to serve from (default: Dir.pwd)</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:engines</span>
          <span class="type">(<tt>String</tt>, <tt>Array&lt;String&gt;</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>List of Tilt-supported template engines to use; default: [ &quot;erubis&quot; ]</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:encoding</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>The string encoding for Tilt to use (default: &#39;utf8&#39;)</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:scope</span>
          <span class="type">(<tt>Object</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>The &#39;scope&#39; object for Tilt evaluation - can define methods that will be available</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:locals</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>Local variables to be defined inside Tilt evaluations</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pixiurge/config_ru.rb', line 311</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_app'>app</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@app</span> <span class='op'>=</span> <span class='id identifier rubyid_app'>app</span>
  <span class='ivar'>@urls</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:urls</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmx</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span>
  <span class='ivar'>@root</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:root</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_pwd'>pwd</span>

  <span class='ivar'>@tilt_scope</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:scope</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'>Object</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@tilt_locals</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:locals</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='id identifier rubyid_engines'>engines</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:engines</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_engines'>engines</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:engines</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_engines'>engines</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>erubis</span><span class='tstring_end'>&quot;</span></span> <span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_engines'>engines</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_engine_name'>engine_name</span><span class='op'>|</span> <span class='id identifier rubyid_require'>require</span> <span class='id identifier rubyid_engine_name'>engine_name</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_bad_engines'>bad_engines</span> <span class='op'>=</span> <span class='id identifier rubyid_engines'>engines</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_eng'>eng</span><span class='op'>|</span> <span class='op'>::</span><span class='const'>Tilt</span><span class='lbracket'>[</span><span class='id identifier rubyid_eng'>eng</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No Tilt templating engine for engine(s): </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bad_engines'>bad_engines</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_bad_engines'>bad_engines</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_tilt_engines'>tilt_engines</span> <span class='op'>=</span> <span class='id identifier rubyid_engines'>engines</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_engine_name'>engine_name</span><span class='op'>|</span> <span class='op'>::</span><span class='const'>Tilt</span><span class='lbracket'>[</span><span class='id identifier rubyid_engine_name'>engine_name</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='comment'># We just want the list of extensions. We&#39;re going to use Tilt&#39;s
</span>  <span class='comment'># default preference priorities for a given extension. If
</span>  <span class='comment'># somebody wants different, they&#39;re allowed to call Tilt.prefer,
</span>  <span class='comment'># likely from config.ru.
</span>  <span class='ivar'>@extensions</span> <span class='op'>=</span> <span class='id identifier rubyid_tilt_engines'>tilt_engines</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_eng'>eng</span><span class='op'>|</span> <span class='op'>::</span><span class='const'>Tilt</span><span class='period'>.</span><span class='id identifier rubyid_default_mapping'>default_mapping</span><span class='period'>.</span><span class='id identifier rubyid_extensions_for'>extensions_for</span><span class='lparen'>(</span><span class='id identifier rubyid_eng'>eng</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>

  <span class='ivar'>@mapped_extensions</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_tilt_engines'>tilt_engines</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_engine'>engine</span><span class='op'>|</span>
    <span class='id identifier rubyid_engine'>engine</span><span class='period'>.</span><span class='id identifier rubyid_default_mime_type'>default_mime_type</span>
  <span class='kw'>end</span>

  <span class='ivar'>@encoding</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:encoding</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>utf8</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="call-instance_method">
  
    #<strong>call</strong>(env)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The Rack .call method for middleware.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>env</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The Rack environment hash.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>0.1.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pixiurge/config_ru.rb', line 348</span>

<span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
  <span class='comment'># If no Tilt path is matched, forward the call to the next middleware
</span>  <span class='id identifier rubyid_call_root'>call_root</span> <span class='op'>=</span> <span class='ivar'>@urls</span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PATH_INFO</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='int'>0</span> <span class='rbrace'>}</span>
  <span class='kw'>return</span> <span class='ivar'>@app</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_call_root'>call_root</span>

  <span class='comment'># A directory was matched. Let&#39;s see if we have any file which,
</span>  <span class='comment'># when we strip the extension, would give us the requested
</span>  <span class='comment'># file.
</span>  <span class='id identifier rubyid_local_path'>local_path</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='ivar'>@root</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PATH_INFO</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_local_extension'>local_extension</span> <span class='op'>=</span> <span class='ivar'>@extensions</span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ext'>ext</span><span class='op'>|</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_local_path'>local_path</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_ext'>ext</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='comment'># No match? 404.
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_local_extension'>local_extension</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>404</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_local_template_file'>local_template_file</span> <span class='op'>=</span> <span class='id identifier rubyid_local_path'>local_path</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_local_extension'>local_extension</span>

  <span class='comment'># Caching these is faster than not. You know what&#39;s faster yet?
</span>  <span class='comment'># Rendering them into a nice static file and serving that via
</span>  <span class='comment'># NGinX. The easiest way to do that for nontrivial cases is
</span>  <span class='comment'># probably using &#39;curl&#39; to get these from the server.
</span>  <span class='id identifier rubyid_template'>template</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>Tilt</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_local_template_file'>local_template_file</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>200</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_template'>template</span><span class='period'>.</span><span class='id identifier rubyid_render'>render</span><span class='lparen'>(</span><span class='ivar'>@tilt_scope</span><span class='comma'>,</span> <span class='ivar'>@tilt_locals</span><span class='rparen'>)</span> <span class='rbracket'>]</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Jun 11 16:00:06 2018 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.12 (ruby-2.5.0).
</div>

    </div>
  </body>
</html>